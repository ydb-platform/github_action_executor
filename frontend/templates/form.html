<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í—ã–±–æ—Ä —Ç–µ—Å—Ç–æ–≤ - GitHub Action Executor</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üéØ –í—ã–±–æ—Ä —Ç–µ—Å—Ç–æ–≤</h1>
            <p class="subtitle">–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: <strong>{{ owner }}/{{ repo }}</strong></p>
            <p class="subtitle">Workflow: <strong>{{ workflow_id }}</strong></p>
        </header>

        <div class="user-info">
            <img src="{{ user.avatar_url }}" alt="{{ user.login }}" class="avatar">
            <span>{{ user.login }}</span>
            <a href="/" class="btn btn-secondary">–ù–∞–∑–∞–¥</a>
        </div>

        <main>
            <form id="testForm" action="/workflow/trigger" method="post" class="test-form">
                <input type="hidden" name="owner" value="{{ owner }}">
                <input type="hidden" name="repo" value="{{ repo }}">
                <input type="hidden" name="workflow_id" value="{{ workflow_id }}">
                
                <div class="form-group">
                    <label for="ref">–í–µ—Ç–∫–∞:</label>
                    <input type="text" id="ref" name="ref" value="{{ ref or 'main' }}" required>
                </div>

                {# –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è - –º–æ–∂–Ω–æ —É–±—Ä–∞—Ç—å –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ #}
                {% if workflow_info %}
                    <div class="info-section" style="margin-bottom: 20px; font-size: 0.9em; background: #fff3cd; border-left: 4px solid #ffc107;">
                        <p><strong>Workflow –Ω–∞–π–¥–µ–Ω:</strong> {{ workflow_info.get('found', False) }}</p>
                        <p><strong>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ inputs:</strong> {{ inputs_schema|length }}</p>
                        {% if inputs_schema %}
                            <p><strong>Inputs keys:</strong> 
                                {% for key in inputs_schema.keys() %}
                                    {{ key }}{% if not loop.last %}, {% endif %}
                                {% endfor %}
                            </p>
                        {% else %}
                            <p><strong>Inputs schema –ø—É—Å—Ç–æ–π –∏–ª–∏ None</strong></p>
                        {% endif %}
                    </div>
                {% endif %}

                {% if inputs_schema %}
                    {% if inputs_schema|length > 0 %}
                    {# –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–æ–ª—è –Ω–∞ –æ—Å–Ω–æ–≤–µ workflow inputs #}
                    {% for input_name, input_config in inputs_schema.items() %}
                        <div class="form-group">
                            <label for="input_{{ input_name }}">
                                {% set field_label = input_config.get('description', '') %}
                                {% if field_label %}
                                    {{ field_label }}
                                {% else %}
                                    {{ input_name|replace('_', ' ')|title }}
                                {% endif %}
                                {% if input_config.get('required', False) %}
                                    <span class="required">*</span>
                                {% endif %}
                            </label>
                            
                            {% if input_config.get('type') == 'choice' %}
                                {# Select –¥–ª—è choice #}
                                <select id="input_{{ input_name }}" name="{{ input_name }}" 
                                        {% if input_config.get('required', False) %}required{% endif %}
                                        class="form-select">
                                    {% if not input_config.get('required', False) %}
                                        <option value="">-- –ù–µ –≤—ã–±—Ä–∞–Ω–æ --</option>
                                    {% endif %}
                                    {% for option in input_config.get('options', []) %}
                                        <option value="{{ option }}" 
                                                {% if option == input_config.get('default') %}selected{% endif %}>
                                            {{ option }}
                                        </option>
                                    {% endfor %}
                                </select>
                            {% elif input_config.get('type') == 'boolean' %}
                                {# Checkbox –¥–ª—è boolean #}
                                <label class="checkbox-label">
                                    <input type="checkbox" id="input_{{ input_name }}" name="{{ input_name }}" 
                                           value="true"
                                           {% if input_config.get('default', False) %}checked{% endif %}>
                                    <span>{{ input_config.get('description', input_name) }}</span>
                                </label>
                            {% elif input_config.get('type') == 'environment' %}
                                {# Select –¥–ª—è environment #}
                                <select id="input_{{ input_name }}" name="{{ input_name }}" 
                                        {% if input_config.get('required', False) %}required{% endif %}
                                        class="form-select">
                                    {% if not input_config.get('required', False) %}
                                        <option value="">-- –ù–µ –≤—ã–±—Ä–∞–Ω–æ --</option>
                                    {% endif %}
                                    {% for env in ['production', 'staging', 'development', 'test'] %}
                                        <option value="{{ env }}" 
                                                {% if env == input_config.get('default') %}selected{% endif %}>
                                            {{ env }}
                                        </option>
                                    {% endfor %}
                                </select>
                            {% else %}
                                {# Text input –¥–ª—è string –∏ –¥—Ä—É–≥–∏—Ö —Ç–∏–ø–æ–≤ #}
                                {% set field_placeholder = input_config.get('description', '') %}
                                {% if not field_placeholder %}
                                    {% set field_placeholder = input_name|replace('_', ' ')|title %}
                                {% endif %}
                                <input type="text" 
                                       id="input_{{ input_name }}" 
                                       name="{{ input_name }}" 
                                       value="{{ input_config.get('default', '') }}"
                                       placeholder="{{ field_placeholder }}"
                                       {% if input_config.get('required', False) %}required{% endif %}
                                       class="form-input">
                            {% endif %}
                        </div>
                    {% endfor %}
                    {% else %}
                        {# inputs_schema —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–æ –ø—É—Å—Ç–æ–π #}
                        <div class="info-section">
                            <p>Workflow –Ω–∞–π–¥–µ–Ω, –Ω–æ –≤ –Ω–µ–º –Ω–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö inputs –≤ workflow_dispatch.</p>
                        </div>
                    {% endif %}
                {% else %}
                    {# –ï—Å–ª–∏ workflow info –Ω–µ –ø–æ–ª—É—á–µ–Ω –∏–ª–∏ inputs –Ω–µ –Ω–∞–π–¥–µ–Ω—ã - –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∏—á–µ–≥–æ #}
                    {% if not workflow_info %}
                        <div class="info-section">
                            <p>–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ workflow. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä—è–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ URL.</p>
                        </div>
                    {% elif workflow_info.get('found') and inputs_schema|length == 0 %}
                        <div class="info-section">
                            <p>Workflow –Ω–∞–π–¥–µ–Ω, –Ω–æ –≤ –Ω–µ–º –Ω–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö inputs –≤ workflow_dispatch.</p>
                        </div>
                    {% endif %}
                {% endif %}

                <button type="submit" class="btn btn-primary" id="submitBtn">
                    üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å Workflow
                </button>
            </form>
        </main>
    </div>

    <script>
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã
        document.getElementById('testForm').addEventListener('submit', function(e) {
            const form = e.target;
            const submitBtn = document.getElementById('submitBtn');
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ–∫–±–æ–∫—Å–æ–≤ tests (–¥–ª—è fallback —Ä–µ–∂–∏–º–∞)
            const testsCheckboxes = form.querySelectorAll('input[name="tests"][type="checkbox"]');
            if (testsCheckboxes.length > 0) {
                const selectedTests = [];
                testsCheckboxes.forEach(function(checkbox) {
                    if (checkbox.checked) {
                        selectedTests.push(checkbox.value);
                    }
                    checkbox.disabled = true;
                });
                
                // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —Å–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è tests (–µ—Å–ª–∏ –µ—Å—Ç—å)
                form.querySelectorAll('input[name="tests"][type="hidden"]').forEach(function(input) {
                    input.remove();
                });
                
                // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ —Å–æ —Å—Ç—Ä–æ–∫–æ–π —Ç–µ—Å—Ç–æ–≤
                if (selectedTests.length > 0) {
                    const testsInput = document.createElement('input');
                    testsInput.type = 'hidden';
                    testsInput.name = 'tests';
                    testsInput.value = selectedTests.join(',');
                    form.appendChild(testsInput);
                }
            }
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ boolean –ø–æ–ª–µ–π - –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ —Å—Ç—Ä–æ–∫—É
            form.querySelectorAll('input[type="checkbox"][name!="tests"]').forEach(function(checkbox) {
                if (!checkbox.checked) {
                    // –î–ª—è –Ω–µ–≤—ã–±—Ä–∞–Ω–Ω—ã—Ö boolean —Å–æ–∑–¥–∞–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º false
                    const hiddenInput = document.createElement('input');
                    hiddenInput.type = 'hidden';
                    hiddenInput.name = checkbox.name;
                    hiddenInput.value = 'false';
                    form.appendChild(hiddenInput);
                } else {
                    checkbox.value = 'true';
                }
            });
            
            submitBtn.disabled = true;
            submitBtn.textContent = '‚è≥ –ó–∞–ø—É—Å–∫ workflow...';
        });
    </script>
</body>
</html>

